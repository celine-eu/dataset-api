{% extends "base.html" %}

{% block title %}{{ dataset.dataset_id }}{% endblock %}

{% block content %}
<section class="dataset-header">
    <h2>{{ dataset.title }}</h2>

    {% if dataset.description %}
    <p class="description">{{ dataset.description }}</p>
    {% endif %}
</section>

<section>
    <h3>Dataset details</h3>
    <dl class="meta">
        <dt>Dataset ID</dt>
        <dd>{{ dataset.dataset_id }}</dd>

        <dt>Backend type</dt>
        <dd>{{ dataset.backend_type }}</dd>

        {% if dataset.access_level %}
        <dt>Access level</dt>
        <dd>{{ dataset.access_level }}</dd>
        {% endif %}



        {% if dataset.publisher_uri %}
        <dt>Publisher URI</dt>
        <dd>{{ dataset.publisher_uri }}</dd>
        {% endif %}

        {% if dataset.rights_holder_uri %}
        <dt>Rights Older URI</dt>
        <dd>{{ dataset.rights_holder_uri }}</dd>
        {% endif %}

        {% if dataset.license_uri %}
        <dt>License</dt>
        <dd>{{ dataset.license_uri }}</dd>
        {% endif %}

        {% if dataset.landing_page %}
        <dt>Landing page</dt>
        <dd>{{ dataset.landing_page }}</dd>
        {% endif %}

        {% if dataset.spatial_uris %}
        <dt>Spatial URI</dt>
        <dd>{{ dataset.spatial_uris }}</dd>
        {% endif %}


    </dl>
</section>

<section>
    <h3>Dataset Schema</h3>

    <p>
        Dataset schema is available via API as
        <a href="/catalogue/{{ dataset.dataset_id }}/schema">
            JSON Schema
        </a>
    </p>

    {% if metadata %}
    <table class="schema-table">
        <thead>
            <tr>
                <th>Column</th>
                <th>Type</th>
                <th>Nullable</th>
                <th>Primary key</th>
                <th>Default</th>
            </tr>
        </thead>
        <tbody>
            {% for col in metadata %}
            <tr>
                <td><code>{{ col.name }}</code></td>
                <td>{{ col.type }}</td>
                <td>{{ "yes" if col.nullable else "no" }}</td>
                <td>{{ "yes" if col.primary_key else "no" }}</td>
                <td>
                    {% if col.default %}
                    <code>{{ col.default }}</code>
                    {% else %}
                    <span class="muted">â€“</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

</section>

<section>
    <h3>API usage</h3>

    <p>
        Use this dataset in SQL queries by referencing its
        <code>dataset_id</code> in the <code>FROM</code> clause.
    </p>

    {% if needs_auth %}
    <p>
        <strong>Authentication required.</strong>
        Requires a bearer token in the <code>Authorization</code> header.
    </p>
    {% else %}
    <p>This dataset is publicly accessible.</p>
    {% endif %}

    <p>Example request with pagination:</p>

    <pre class="shell"><code>{{ example_curl }}</code></pre>

    <p class="muted">
        The query API automatically resolves referenced datasets and
        enforces access control per dataset.
    </p>

    <p class="hint">
        Use <code>limit</code> and <code>offset</code> to paginate through results.
    </p>
</section>

{% endblock %}